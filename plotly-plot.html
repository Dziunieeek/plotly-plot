<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="plotly-import.html">

<!--
Polymer element for the plotly.js library

Example:

  <plotly-plot data="[2, 3]">
  </plotly-plot>

@demo demo/index.html
-->

<dom-module id="plotly-plot">
  <template>
    <div id="plot"></div>
  </template>

  <script>
    Polymer({
      is: 'plotly-plot',

      properties: {
        data: {
          type: Object,
          reflectToAttribute: true,
          notify: true,
          observer: 'redraw'
        },
        layout: {
          type: Object,
          reflectToAttribute: true,
          notify: true,
          observer: 'redraw'
        },
        config: {
          type: Object,
          reflectToAttribute: true,
          notify: true,
          observer: 'redraw'
        },
      },

      // Life Cycle

      attached: function () {
        Plotly.newPlot(this.$.plot, this.data, this.layout, this.config);

        // fire Polymer events in accordance with the plotly.js ones as well
        this.$.plot.on('plotly_click', this._onPlotlyClick);
        this.$.plot.on('plotly_beforehover', this._onPlotlyBeforeHover);
        this.$.plot.on('plotly_hover', this._onPlotlyHover);
        this.$.plot.on('plotly_unhover', this._onPlotlyUnHover);
      },

      detached: function () {
        // remove the attached Polymer events
        this.$.plot.removeListner('plotly_click', this._onPlotlyClick);
        this.$.plot.removeListner('plotly_beforehover', this._onPlotlyBeforeHover);
        this.$.plot.removeListner('plotly_hover', this._onPlotlyHover);
        this.$.plot.removeListner('plotly_unhover', this._onPlotlyUnHover);
      },

      // Refresh

      redraw: function () {
        this.$.plot.data = this.data;
        this.$.plot.layout = this.layout;
        this.$.plot.config = this.config;

        Plotly.redraw(this.$.plot);
      },

      restyle: function (style, traceIndices) {
        Plotly.restyle(this.$.plot, style, traceIndices);
      },

      relayout: function (layout) {
        Plotly.layout(this.$.plot, layout);
      },

      // These event handlers need to be bound to variables because of
      // event binding and unbinding upon attach/detach/reattach
      _onPlotlyClick: function (data) {
        this.fire('plotly-click', {data: data});
      },

      _onPlotlyBeforeHover: function (data) {
        this.fire('plotly-beforehover', {data: data});
      },

      _onPlotlyHover: function (data) {
        this.fire('plotly-hover', {data: data});
      },

      _onPlotlyUnHover: function (data) {
        this.fire('plotly-unhover', {data: data});
      }
    });
  </script>
</dom-module>
